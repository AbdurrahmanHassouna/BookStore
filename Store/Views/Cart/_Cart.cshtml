@model IList<Store.Models.CartItem>

<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th scope="col">Book Name</th>
            <th scope="col">Price</th>
            <th scope="col">Quantity</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @for(int i=0;i<Model.Count;i++)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => Model[i].Book.Name)
                </td>
                <td>
                    ( $@Model[i].Book.Price x @Model[i].Quantity )   ==>   $@Html.DisplayFor(modelItem => Model[i].Price)
                </td>
                <td>
                    @using (Ajax.BeginForm("UpdateCart", "Cart", new { Id = Model[i].Book.Id }, new AjaxOptions
                    {
                        HttpMethod = "POST",
                        InsertionMode = InsertionMode.Replace,
                        UpdateTargetId = "Cart",
                        OnBegin="ClearResult"
                    }))
                    {
                        <div class="dropdown-container">
                            <div class="dropdown-toggle">
                                @Html.DropDownList("Quantity", Model[i].Book.selectListItems, new
                           {
                               @class = "form-control dropdown",
                               @value = Model[i].Quantity,
                               @selected = "selected"
                               
                           })
                                <div class="slide-content">

                                </div>
                            </div>
                        </div>
                    }
                </td>
                <td>
                    @Ajax.ActionLink("Delete", "Delete", "Cart", new { @id = Model[i].Book.Id },
                        new AjaxOptions
                        {
                            HttpMethod = "POST",
                            InsertionMode = InsertionMode.Replace,
                            UpdateTargetId = "Cart"
                        }, new { @class = "btn btn-danger" })
                </td>
            </tr>
        }
    </tbody>
</table>
<div class="mt-4">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Order Total</h5>
            <p class="card-text">
                Total: $@Model.Sum(item => item.Price)
            </p>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.dropdown-toggle').click(function () {
            // Toggle the visibility of the slide content
            $(this).next('.slide-content').slideToggle();
        });

        // Handle change event for dropdowns with the 'form-control' class
        $('.dropdown').change(function (e) {
            // Submit the form when the dropdown changes
            $(this).closest('form').submit();
        });
        /*$('.dropdown').change(function (e) {
            var dropdownId = $(this).attr('id'); // Get ID of changed dropdown
            var formId = dropdownId.replace('dropdown', 'form'); // Assuming forms have IDs like 'form123'
            $('#' + formId).submit(); // Submit only the relevant form
        });*/
    });
    function ClearResult() {
        $("#Cart").empty();
    }
</script>
